# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none

pool:
  vmImage: 'windows-latest'

steps:
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
    
      #Get current dll files
      git lfs install
      git clone https://github.com/Nun-z/RetroArch-Redist.git

      #Get fresh cores from buildbot
      $url = "http://buildbot.libretro.com/nightly/windows/x86_64/RetroArch_cores.7z"
      $output = "./RetroArchCores.7z"
      Invoke-WebRequest -Uri $url -OutFile $output

      #Get fresh non-core dll files from buildbot
      $url = "http://buildbot.libretro.com/nightly/windows/x86_64/RetroArch_update.7z"
      $output = "./RetroArchOther.7z"
      Invoke-WebRequest -Uri $url -OutFile $output
      
      #Extract 7z files
      sz x -o$./RetroArch-Redist/cores/ ./RetroArchCores.7z -r ;
      sz x -o$./RetroArch-Redist/other/ ./RetroArchOther.7z -r ;
      
      #Send new .dll files to repo
      git lfs track "*.dll"
      git add .
      git commit -m "Get fresh cores from buildbot"
      git push

container:
